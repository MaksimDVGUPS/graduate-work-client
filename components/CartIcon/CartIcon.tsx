import Link from "next/link";
import React, {useEffect} from "react";
import {useTypedSelector} from "../../hooks/useTypedSelector";
import styles from './CartIcon.module.scss'
import {useActions} from "../../hooks/useActions";
import {CartState} from "../../store/slices/cart";

const CartIcon = () => {
    const {count} = useTypedSelector(state => state.cart);
    const {dispatchSetCart} = useActions();

    useEffect(() => {
        const dispatchCart = async (cart: CartState) => {
            try {
                await dispatchSetCart(cart)
            } catch (e) {}
        }
        const cartStr = localStorage.getItem('cart');
        if (cartStr) {
            const cart = JSON.parse(cartStr);
            dispatchCart(cart);
        }
    }, [])

    return (
        <Link href={'/cart'}>
            <a className={styles.cart}>
                <svg viewBox="0 0 24 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 20.5C6 21.1631 6.31629 21.7989 6.87883 22.2678C7.44134 22.7366 8.20448 23 9 23C9.79577 23 10.5589 22.7366 11.1214 22.2678C11.6839 21.7989 12 21.1631 12 20.5C12 19.8371 11.6839 19.2011 11.1214 18.7324C10.5589 18.2634 9.79577 18 9 18C8.20472 18.0008 7.44231 18.2644 6.87975 18.7331C6.31748 19.2017 6.00092 19.8372 6 20.5ZM10.624 20.5C10.624 20.859 10.4529 21.2031 10.1483 21.4569C9.8438 21.7107 9.43077 21.8533 9.00005 21.8533C8.56952 21.8533 8.15655 21.7107 7.85195 21.4569C7.54735 21.2031 7.37631 20.8589 7.37631 20.5C7.37631 20.1412 7.54742 19.7969 7.85195 19.5431C8.15648 19.2893 8.56951 19.1469 9.00005 19.1469C9.42962 19.1483 9.84097 19.2915 10.144 19.5453C10.4469 19.7989 10.617 20.1422 10.617 20.5L10.624 20.5Z" fill="#85999F"/>
                    <path d="M19 18C18.2042 18 17.4413 18.2634 16.8786 18.7324C16.3161 19.2011 16 19.8371 16 20.5C16 21.1631 16.3161 21.7989 16.8786 22.2678C17.4413 22.7366 18.2042 23 19 23C19.7955 23 20.5587 22.7366 21.1212 22.2678C21.6839 21.7989 22 21.1631 22 20.5C21.999 19.8373 21.6827 19.2017 21.1203 18.7331C20.558 18.2644 19.7953 18.0008 19 18ZM19 21.8533C18.5692 21.8533 18.1563 21.7107 17.8517 21.4569C17.5472 21.2032 17.3761 20.859 17.3761 20.5C17.3761 20.1413 17.5472 19.7969 17.8517 19.5431C18.1563 19.2894 18.5693 19.147 19 19.147C19.4305 19.147 19.8438 19.2894 20.1483 19.5431C20.4528 19.7969 20.6237 20.1413 20.6237 20.5C20.623 20.8584 20.4514 21.202 20.1468 21.4552C19.8426 21.7081 19.43 21.8503 19 21.8503L19 21.8533Z" fill="#85999F"/>
                    <path d="M0.654313 1.31761H4.51295L7.33828 15.4721V15.4719C7.4001 15.7836 7.67565 16.0058 7.99248 15.9999H21.1612C21.4657 15.9999 21.7303 15.7893 21.7987 15.4916L23.9833 5.94615C24.028 5.75134 23.9819 5.54669 23.8576 5.39029C23.7335 5.23389 23.5449 5.14289 23.3455 5.14311H13.6887C13.5313 5.14311 13.3792 5.20028 13.2603 5.30363L9.8855 8.25372V8.25395C9.64462 8.49838 9.63321 8.888 9.85926 9.14662C10.0853 9.405 10.4722 9.44455 10.7455 9.23716L13.9371 6.44758H22.5376L20.6409 14.6888H8.5122L5.69008 0.527861C5.62827 0.216205 5.35272 -0.00604996 5.03612 0.00012556H0.654201C0.292881 0.00012556 0 0.29349 0 0.655668C0 1.01763 0.292887 1.31121 0.654201 1.31121L0.654313 1.31761Z" fill="#85999F"/>
                </svg>
                {count ? <span>{count}</span> : ''}
            </a>
        </Link>
    );
};

export default CartIcon;